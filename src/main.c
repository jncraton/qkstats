#include "ulibc.h"

long nth_int(char* filename, int n) {
  char content[255];

  FILE* fp = open(filename, O_RDONLY);
  read(fp, content, 255);
  close(fp);

  char* tok = strtok(content,"\t ");
  while (tok) {
    if (n == 0) { return atol(tok); }
    n--;
    tok = strtok(0x00,"\t ");
  }

  return -1;
}

int main() {
  long io_start = nth_int("/sys/block/sda/stat", 9);

  sleep(1);

  long io_ticks = nth_int("/sys/block/sda/stat", 9) - io_start;

  // ○◔◑◕● = 0xe2 0x97 0x8b 0xe2 0x97 0x94 0xe2 0x97 0x91 0xe2 0x97 0x95 0xe2 0x97 0x8f
  // ·▪■ = 0xc2 0xb7 0xe2 0x96 0xaa 0xe2 0x96 0xa0
  // □⬓■ = 0xe2 0x96 0xa1 0xe2 0xac 0x93 0xe2 0x96 0xa0
  // ▁▂▃▄▅▆▇█ = 0xe2 0x96 0x81 0xe2 0x96 0x82 0xe2 0x96 0x83 0xe2 0x96 0x84 0xe2 0x96 0x85 0xe2 0x96 0x86 0xe2 0x96 0x87 0xe2 0x96 0x88
  // ▏▎▍▌▋▊▉█ = 0x20 0xe2 0x96 0x8f 0xe2 0x96 0x8e 0xe2 0x96 0x8d 0xe2 0x96 0x8c 0xe2 0x96 0x8b 0xe2 0x96 0x8a 0xe2 0x96 0x89 0xe2 0x96 0x88
  
  char buf[16];
  sprintf(buf, "I/O ticks: \xe2\x97\x8b \xe2\x97\x94 \xe2\x97\x91 \xe2\x97\x95 \xe2\x97\x8f %d\n", (int)io_ticks);
  write(stdout, buf, strlen(buf));
}
